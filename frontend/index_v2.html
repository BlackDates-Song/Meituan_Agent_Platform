<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¾å›¢å¤–å–æ¨èä¸è¿è¥åˆ†æå¹³å° V2</title>
    <link rel="stylesheet" href="static/css/style_v2.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div id="app">
        <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
        <header class="header">
            <div class="container">
                <h1 class="logo">ğŸ” ç¾å›¢å¤–å–æ™ºèƒ½å¹³å° V2</h1>
                <div class="version-badge">ç¬¬ä¸‰é˜¶æ®µå¢å¼ºç‰ˆ</div>
                <nav class="nav">
                    <button @click="currentView = 'recommend'" :class="{active: currentView === 'recommend'}">
                        æ™ºèƒ½æ¨è
                    </button>
                    <button @click="currentView = 'rag'" :class="{active: currentView === 'rag'}">
                        RAGæœç´¢ <span class="badge">NEW</span>
                    </button>
                    <button @click="currentView = 'operation'" :class="{active: currentView === 'operation'}">
                        è¿è¥åˆ†æ <span class="badge">Agent</span>
                    </button>
                    <button @click="currentView = 'comment'" :class="{active: currentView === 'comment'}">
                        è¯„è®ºæ‘˜è¦ <span class="badge">NEW</span>
                    </button>
                    <button @click="currentView = 'qa'" :class="{active: currentView === 'qa'}">
                        æ™ºèƒ½é—®ç­” <span class="badge">RAG</span>
                    </button>
                    <button @click="currentView = 'stats'" :class="{active: currentView === 'stats'}">
                        å¹³å°ç»Ÿè®¡
                    </button>
                </nav>
            </div>
        </header>

        <!-- ä¸»å†…å®¹åŒº -->
        <main class="main-content">
            <!-- æ™ºèƒ½æ¨èæ¨¡å— -->
            <div v-if="currentView === 'recommend'" class="module fade-in">
                <div class="module-header">
                    <h2>ğŸ¯ æ™ºèƒ½æ¨èç³»ç»Ÿ</h2>
                    <p class="module-desc">åŸºäºååŒè¿‡æ»¤ + å›¾åµŒå…¥çš„ä¸ªæ€§åŒ–æ¨è</p>
                </div>
                
                <div class="card">
                    <div class="form-row">
                        <div class="form-group">
                            <label>ç”¨æˆ·ID:</label>
                            <input v-model="recommendForm.user_id" type="text" placeholder="è¾“å…¥ç”¨æˆ·ID">
                        </div>
                        <div class="form-group">
                            <label>æ¨èæ•°é‡:</label>
                            <input v-model.number="recommendForm.top_k" type="number" min="1" max="20">
                        </div>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input v-model="recommendForm.use_llm" type="checkbox">
                                ä½¿ç”¨LLMç”Ÿæˆæ¨èç†ç”±
                            </label>
                        </div>
                    </div>
                    <button @click="getRecommendations" class="btn-primary" :disabled="loading">
                        <span v-if="!loading">ğŸ” è·å–æ¨è</span>
                        <span v-else class="loading-spinner">â³ åŠ è½½ä¸­...</span>
                    </button>
                </div>

                <!-- æ¨èç»“æœ -->
                <div v-if="recommendations.length > 0" class="results fade-in">
                    <h3>ğŸ’« æ¨èç»“æœ ({{ recommendations.length }}ä¸ª)</h3>
                    <div class="result-grid">
                        <div v-for="(item, index) in recommendations" :key="index" class="result-card hover-lift">
                            <div class="rank-badge">Top {{ index + 1 }}</div>
                            <div class="result-content">
                                <h4>{{ item.name }}</h4>
                                <div class="result-meta">
                                    <span v-if="item.category" class="meta-item">
                                        ğŸ·ï¸ {{ item.category }}
                                    </span>
                                    <span v-if="item.score" class="meta-item">
                                        â­ {{ item.score.toFixed(2) }}
                                    </span>
                                        <span v-if="item.price && item.price > 0" class="meta-item">
                                        ğŸ’° Â¥{{ item.price.toFixed(1) }}
                                    </span>
                                    <span v-else-if="item.price === 0" class="meta-item" style="color: #999;">
                                        ğŸ’° æš‚æ— ä»·æ ¼
                                    </span>
                                    <span v-if="item.district" class="meta-item">
                                        ğŸ“ {{ item.district }}
                                    </span>
                                </div>
                                <div v-if="item.llm_reason" class="llm-reason">
                                    ğŸ’¡ <strong>æ¨èç†ç”±:</strong> {{ item.llm_reason }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- RAGæ™ºèƒ½æœç´¢æ¨¡å— -->
            <div v-if="currentView === 'rag'" class="module fade-in">
                <div class="module-header">
                    <h2>ğŸ” RAGè¯­ä¹‰æœç´¢</h2>
                    <p class="module-desc">å‘é‡æ£€ç´¢ + æ„å›¾è§£æ + å¤šè·¯å¬å›èåˆ</p>
                </div>
                
                <div class="card">
                    <div class="search-box">
                        <input v-model="ragForm.query" 
                               type="text" 
                               placeholder="è¯•è¯•ï¼šé™„è¿‘è¯„åˆ†é«˜çš„å·èœé¦†ã€æœé˜³åŒº100å…ƒä»¥ä¸‹çš„æ—¥æ–™..."
                               @keyup.enter="ragSearch"
                               class="search-input">
                        <button @click="ragSearch" class="btn-primary" :disabled="loading">
                            <span v-if="!loading">ğŸš€ æ™ºèƒ½æœç´¢</span>
                            <span v-else class="loading-spinner">â³ æœç´¢ä¸­...</span>
                        </button>
                    </div>
                    
                    <!-- æ„å›¾è§£æç»“æœ -->
                    <div v-if="ragResult && ragResult.intent" class="intent-panel">
                        <h4>ğŸ§  æ„å›¾ç†è§£</h4>
                        <div class="intent-tags">
                            <span v-for="intent in ragResult.intent.intents" :key="intent" class="tag">
                                {{ intent }}
                            </span>
                        </div>
                        <div v-if="ragResult.intent.filters" class="filters">
                            <span v-for="(value, key) in ragResult.intent.filters" :key="key" class="filter-tag">
                                {{ key }}: {{ value }}
                            </span>
                        </div>
                        <div v-if="ragResult.intent.llm_analysis" class="llm-analysis">
                            ğŸ’¬ {{ ragResult.intent.llm_analysis }}
                        </div>
                    </div>
                </div>

                <!-- RAGæœç´¢ç»“æœ -->
                <div v-if="ragResult && ragResult.results && ragResult.results.length > 0" class="results fade-in">
                    <h3>ğŸ¯ æœç´¢ç»“æœ ({{ ragResult.total }}ä¸ª)</h3>
                    <div class="result-grid">
                        <div v-for="(item, index) in ragResult.results" :key="index" class="result-card hover-lift">
                            <div class="result-content">
                                <h4>{{ item.name }}</h4>
                                <div class="result-meta">
                                    <span class="meta-item">ğŸ·ï¸ {{ item.category }}</span>
                                    <span class="meta-item">â­ {{ item.score.toFixed(2) }}</span>
                                    <span v-if="item.price && item.price > 0" class="meta-item">
                                        ğŸ’° Â¥{{ item.price.toFixed(1) }}
                                    </span>
                                    <span v-else class="meta-item" style="color: #999;">
                                        ğŸ’° æš‚æ— ä»·æ ¼
                                    </span>
                                    <span class="meta-item">ğŸ“ {{ item.district }}</span>
                                </div>
                                <div class="result-sources">
                                    <small>æ¥æº: {{ item.sources.join(', ') }}</small>
                                    <small v-if="item.rank_score">å¾—åˆ†: {{ item.rank_score.toFixed(3) }}</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Agentè¿è¥åˆ†ææ¨¡å— -->
            <div v-if="currentView === 'operation'" class="module fade-in">
                <div class="module-header">
                    <h2>ğŸ“Š Agentæ™ºèƒ½è¿è¥åˆ†æ</h2>
                    <p class="module-desc">å¤šAgentåä½œï¼šæ•°æ®åˆ†æ â†’ ç«å“åˆ†æ â†’ è¿è¥å»ºè®® â†’ æŠ¥å‘Šç”Ÿæˆ</p>
                </div>
                
                <div class="card">
                    <div class="form-row">
                        <div class="form-group">
                            <label>å•†å®¶ID:</label>
                            <input v-model="operationForm.poi_id" type="text" placeholder="è¾“å…¥å•†å®¶POI ID">
                        </div>
                        <button @click="getOperationAnalysis" class="btn-primary" :disabled="loading">
                            <span v-if="!loading">ğŸ¤– å¯åŠ¨Agentåˆ†æ</span>
                            <span v-else class="loading-spinner">â³ Agentå·¥ä½œä¸­...</span>
                        </button>
                    </div>
                </div>

                <!-- è¿è¥åˆ†ææŠ¥å‘Š -->
                <div v-if="operationReport" class="analysis-report fade-in">
                    <h3>ğŸ“‹ è¿è¥åˆ†ææŠ¥å‘Š</h3>
                    
                    <!-- åŸºæœ¬ä¿¡æ¯ -->
                    <div v-if="operationReport['åŸºæœ¬ä¿¡æ¯']" class="report-section">
                        <h4>ğŸª åŸºæœ¬ä¿¡æ¯</h4>
                        <div class="info-grid">
                            <div v-for="(value, key) in operationReport['åŸºæœ¬ä¿¡æ¯']" :key="key" class="info-item">
                                <strong>{{ key }}:</strong> {{ value }}
                            </div>
                        </div>
                    </div>

                    <!-- ç»è¥æ•°æ® -->
                    <div v-if="operationReport['ç»è¥æ•°æ®']" class="report-section">
                        <h4>ğŸ’¹ ç»è¥æ•°æ®</h4>
                        <div class="stats-grid">
                            <div v-for="(value, key) in operationReport['ç»è¥æ•°æ®']" :key="key" class="stat-card">
                                <div class="stat-value">{{ value }}</div>
                                <div class="stat-label">{{ key }}</div>
                            </div>
                        </div>
                    </div>

                    <!-- çƒ­é”€èœå“ -->
                    <div v-if="operationReport['çƒ­é”€èœå“TOP10']" class="report-section">
                        <h4>ğŸ”¥ çƒ­é”€èœå“ TOP10</h4>
                        <div class="hot-items">
                            <div v-for="(item, index) in operationReport['çƒ­é”€èœå“TOP10']" :key="index" class="hot-item">
                                <span class="item-rank">{{ index + 1 }}</span>
                                <span class="item-name">{{ item.åç§° }}</span>
                                <span class="item-tag">{{ item.æ ‡ç­¾ }}</span>
                                <span class="item-sales">{{ item.é”€é‡ }}å•</span>
                            </div>
                        </div>
                    </div>

                    <!-- ç”¨æˆ·ç”»åƒ -->
                    <div v-if="operationReport['ç”¨æˆ·ç”»åƒ']" class="report-section">
                        <h4>ğŸ‘¥ ç”¨æˆ·ç”»åƒ</h4>
                        <div class="profile-data">
                            <div v-if="operationReport['ç”¨æˆ·ç”»åƒ'].gender_distribution">
                                <strong>æ€§åˆ«åˆ†å¸ƒ:</strong>
                                <span v-for="(count, gender) in operationReport['ç”¨æˆ·ç”»åƒ'].gender_distribution" :key="gender">
                                    {{ gender }}: {{ count }} |
                                </span>
                            </div>
                            <div v-if="operationReport['ç”¨æˆ·ç”»åƒ'].age_distribution">
                                <strong>å¹´é¾„åˆ†å¸ƒ:</strong>
                                <span v-for="(count, age) in operationReport['ç”¨æˆ·ç”»åƒ'].age_distribution" :key="age">
                                    {{ age }}å²: {{ count }} |
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- è¿è¥å»ºè®® -->
                    <div v-if="operationReport['è¿è¥å»ºè®®']" class="report-section">
                        <h4>ğŸ’¡ è¿è¥å»ºè®®</h4>
                        <div class="suggestions">
                            <template v-for="(items, category) in operationReport['è¿è¥å»ºè®®']" :key="category">
                                <div v-if="category !== 'LLMå»ºè®®'" class="suggestion-category">
                                    <h5>{{ category }}:</h5>
                                    <ul>
                                        <li v-for="(item, idx) in items" :key="idx">{{ item }}</li>
                                    </ul>
                                </div>
                            </template>
                            <div v-if="operationReport['è¿è¥å»ºè®®']['LLMå»ºè®®']" class="llm-advice">
                                <h5>LLMå»ºè®®:</h5>
                                <p>{{ operationReport['è¿è¥å»ºè®®']['LLMå»ºè®®'] }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- è¯„è®ºæ‘˜è¦æ¨¡å— -->
            <div v-if="currentView === 'comment'" class="module fade-in">
                <div class="module-header">
                    <h2>ğŸ’¬ è¯„è®ºæ™ºèƒ½æ‘˜è¦</h2>
                    <p class="module-desc">LLMé©±åŠ¨çš„è¯„è®ºæƒ…æ„Ÿåˆ†æä¸æ‘˜è¦ç”Ÿæˆ</p>
                </div>
                
                <div class="card">
                    <div class="form-row">
                        <div class="form-group">
                            <label>å•†å®¶ID:</label>
                            <input v-model="commentForm.poi_id" type="text" placeholder="è¾“å…¥å•†å®¶POI ID">
                        </div>
                        <button @click="getCommentSummary" class="btn-primary" :disabled="loading">
                            <span v-if="!loading">ğŸ“Š ç”Ÿæˆæ‘˜è¦</span>
                            <span v-else class="loading-spinner">â³ åˆ†æä¸­...</span>
                        </button>
                    </div>
                </div>

                <!-- è¯„è®ºæ‘˜è¦ç»“æœ -->
                <div v-if="commentSummary" class="summary-result fade-in">
                    <h3>ğŸ“ è¯„è®ºæ‘˜è¦ - {{ commentSummary.poi_name }}</h3>
                    
                    <div class="summary-stats">
                        <div class="stat-card">
                            <div class="stat-value">{{ commentSummary.total_reviews }}</div>
                            <div class="stat-label">æ€»è¯„è®ºæ•°</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">{{ commentSummary.average_score }}</div>
                            <div class="stat-label">å¹³å‡è¯„åˆ†</div>
                        </div>
                    </div>

                    <!-- æƒ…æ„Ÿåˆ†å¸ƒ -->
                    <div v-if="commentSummary.sentiment" class="sentiment-section">
                        <h4>ğŸ˜Š æƒ…æ„Ÿåˆ†å¸ƒ</h4>
                        <div class="sentiment-bars">
                            <div class="sentiment-bar">
                                <span>æ­£é¢ {{ commentSummary.sentiment.positive }}%</span>
                                <div class="bar positive" :style="{width: commentSummary.sentiment.positive + '%'}"></div>
                            </div>
                            <div class="sentiment-bar">
                                <span>ä¸­æ€§ {{ commentSummary.sentiment.neutral }}%</span>
                                <div class="bar neutral" :style="{width: commentSummary.sentiment.neutral + '%'}"></div>
                            </div>
                            <div class="sentiment-bar">
                                <span>è´Ÿé¢ {{ commentSummary.sentiment.negative }}%</span>
                                <div class="bar negative" :style="{width: commentSummary.sentiment.negative + '%'}"></div>
                            </div>
                        </div>
                    </div>

                    <!-- ä¼˜ç¼ºç‚¹ -->
                    <div class="pros-cons">
                        <div class="pros">
                            <h4>ğŸ‘ ä¼˜ç‚¹</h4>
                            <ul>
                                <li v-for="(item, idx) in commentSummary.positive_aspects" :key="idx">{{ item }}</li>
                            </ul>
                        </div>
                        <div class="cons">
                            <h4>ğŸ‘ ç¼ºç‚¹</h4>
                            <ul>
                                <li v-for="(item, idx) in commentSummary.negative_aspects" :key="idx">{{ item }}</li>
                            </ul>
                        </div>
                    </div>

                    <!-- LLMæ‘˜è¦ -->
                    <div v-if="commentSummary.llm_summary" class="llm-summary">
                        <h4>ğŸ¤– LLMç»¼åˆè¯„ä»·</h4>
                        <p>{{ commentSummary.llm_summary }}</p>
                    </div>
                </div>
            </div>

            <!-- æ™ºèƒ½é—®ç­”æ¨¡å— -->
            <div v-if="currentView === 'qa'" class="module fade-in">
                <div class="module-header">
                    <h2>ğŸ¤” RAGæ™ºèƒ½é—®ç­”</h2>
                    <p class="module-desc">åŸºäºå‘é‡æ£€ç´¢çš„ä¸Šä¸‹æ–‡æ„ŸçŸ¥é—®ç­”ç³»ç»Ÿ</p>
                </div>
                
                <div class="card">
                    <div class="qa-input">
                        <textarea v-model="qaForm.question" 
                                  placeholder="è¾“å…¥æ‚¨çš„é—®é¢˜ï¼Œä¾‹å¦‚ï¼š&#10;- æ¨èä¸€äº›è¯„åˆ†é«˜çš„å·èœé¦†&#10;- å¦‚ä½•æå‡å•†å®¶è¯„åˆ†&#10;- æœé˜³åŒºæœ‰å“ªäº›çƒ­é—¨æ—¥æ–™åº—"
                                  rows="3"></textarea>
                        <button @click="askQuestion" class="btn-primary" :disabled="loading">
                            <span v-if="!loading">ğŸ’¬ æé—®</span>
                            <span v-else class="loading-spinner">â³ æ€è€ƒä¸­...</span>
                        </button>
                    </div>
                </div>

                <!-- é—®ç­”å†å² -->
                <div v-if="qaHistory.length > 0" class="qa-history fade-in">
                    <h3>ğŸ’­ é—®ç­”è®°å½•</h3>
                    <div v-for="(qa, index) in qaHistory" :key="index" class="qa-pair">
                        <div class="question">
                            <strong>ğŸ§‘ é—®:</strong> {{ qa.question }}
                        </div>
                        <div class="answer">
                            <strong>ğŸ¤– ç­”:</strong> {{ qa.answer }}
                        </div>
                    </div>
                </div>
            </div>

            <!-- å¹³å°ç»Ÿè®¡æ¨¡å— -->
            <div v-if="currentView === 'stats'" class="module fade-in">
                <div class="module-header">
                    <h2>ğŸ“ˆ å¹³å°ç»Ÿè®¡</h2>
                    <p class="module-desc">æ•°æ®æ€»è§ˆä¸å‘é‡ç´¢å¼•çŠ¶æ€</p>
                </div>
                
                <div v-if="stats" class="stats-dashboard">
                    <div class="stats-grid">
                        <div class="stat-card big">
                            <div class="stat-icon">ğŸ‘¥</div>
                            <div class="stat-value">{{ stats.total_users }}</div>
                            <div class="stat-label">ç”¨æˆ·æ€»æ•°</div>
                        </div>
                        <div class="stat-card big">
                            <div class="stat-icon">ğŸª</div>
                            <div class="stat-value">{{ stats.total_pois }}</div>
                            <div class="stat-label">å•†å®¶æ€»æ•°</div>
                        </div>
                        <div class="stat-card big">
                            <div class="stat-icon">ğŸœ</div>
                            <div class="stat-value">{{ stats.total_spus }}</div>
                            <div class="stat-label">èœå“æ€»æ•°</div>
                        </div>
                        <div class="stat-card big">
                            <div class="stat-icon">ğŸ“¦</div>
                            <div class="stat-value">{{ stats.total_orders }}</div>
                            <div class="stat-label">è®¢å•æ€»æ•°</div>
                        </div>
                    </div>

                    <!-- å‘é‡ç´¢å¼•çŠ¶æ€ -->
                    <div v-if="stats.vector_indexed" class="vector-status">
                        <h3>ğŸ” å‘é‡ç´¢å¼•çŠ¶æ€</h3>
                        <div class="vector-stats">
                            <div class="vector-stat">
                                <span>å•†å®¶ç´¢å¼•:</span>
                                <strong>{{ stats.vector_indexed.pois }}</strong>
                            </div>
                            <div class="vector-stat">
                                <span>èœå“ç´¢å¼•:</span>
                                <strong>{{ stats.vector_indexed.spus }}</strong>
                            </div>
                            <div class="vector-stat">
                                <span>è¯„è®ºç´¢å¼•:</span>
                                <strong>{{ stats.vector_indexed.comments }}</strong>
                            </div>
                        </div>
                        <button @click="buildVectorIndex" class="btn-secondary" :disabled="loading">
                            {{ loading ? 'æ„å»ºä¸­...' : 'ğŸ”„ é‡å»ºå‘é‡ç´¢å¼•' }}
                        </button>
                    </div>
                </div>

                <button @click="loadStats" class="btn-secondary">ğŸ”„ åˆ·æ–°ç»Ÿè®¡</button>
            </div>
        </main>

        <!-- é¡µè„š -->
        <footer class="footer">
            <p>ç¾å›¢å¤–å–æ¨èä¸è¿è¥åˆ†æå¹³å° V2 | ç¬¬ä¸‰é˜¶æ®µï¼šRAG + Agent + æ™ºèƒ½åŠŸèƒ½ ğŸš€</p>
        </footer>
    </div>

    <script src="static/js/app_v2.js"></script>
</body>
</html>
