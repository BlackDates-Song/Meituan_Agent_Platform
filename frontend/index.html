<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¾å›¢å¤–å–æ¨èä¸è¿è¥åˆ†æå¹³å°</title>
    <link rel="stylesheet" href="static/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div id="app">
        <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
        <header class="header">
            <div class="container">
                <h1 class="logo">ğŸ” ç¾å›¢å¤–å–æ™ºèƒ½æ¨èå¹³å°</h1>
                <nav class="nav">
                    <button @click="currentView = 'recommend'" :class="{active: currentView === 'recommend'}">
                        æ™ºèƒ½æ¨è
                    </button>
                    <button @click="currentView = 'search'" :class="{active: currentView === 'search'}">
                        æ™ºèƒ½æœç´¢
                    </button>
                    <button @click="currentView = 'operation'" :class="{active: currentView === 'operation'}">
                        è¿è¥åˆ†æ
                    </button>
                    <button @click="currentView = 'stats'" :class="{active: currentView === 'stats'}">
                        å¹³å°ç»Ÿè®¡
                    </button>
                </nav>
            </div>
        </header>

        <!-- ä¸»å†…å®¹åŒº -->
        <main class="main-content">
            <!-- æ™ºèƒ½æ¨èæ¨¡å— -->
            <div v-if="currentView === 'recommend'" class="module">
                <h2>ğŸ¯ æ™ºèƒ½æ¨èç³»ç»Ÿ</h2>
                <div class="card">
                    <div class="form-group">
                        <label>ç”¨æˆ·ID:</label>
                        <input v-model.number="recommendForm.user_id" type="number" placeholder="è¯·è¾“å…¥ç”¨æˆ·ID">
                    </div>
                    <div class="form-group">
                        <label>æ¨èç±»å‹:</label>
                        <select v-model="recommendForm.rec_type">
                            <option value="poi">æ¨èå•†å®¶</option>
                            <option value="spu">æ¨èèœå“</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>æ¨èæ•°é‡:</label>
                        <input v-model.number="recommendForm.top_k" type="number" min="1" max="20">
                    </div>
                    <button @click="getRecommendations" class="btn-primary" :disabled="loading">
                        {{ loading ? 'åŠ è½½ä¸­...' : 'è·å–æ¨è' }}
                    </button>
                </div>

                <!-- æ¨èç»“æœ -->
                <div v-if="recommendations.length > 0" class="results">
                    <h3>æ¨èç»“æœ ({{ recommendations.length }}ä¸ª)</h3>
                    <div class="result-grid">
                        <div v-for="(item, index) in recommendations" :key="index" class="result-card">
                            <div class="rank">Top {{ index + 1 }}</div>
                            <div class="result-content">
                                <h4>{{ item.wm_poi_name || item.wm_food_spu_name }}</h4>
                                <div v-if="item.poi_score" class="score">
                                    â­ è¯„åˆ†: {{ item.poi_score.toFixed(2) }}
                                </div>
                                <div v-if="item.price" class="price">
                                    ğŸ’° ä»·æ ¼: Â¥{{ item.price }}
                                </div>
                                <div v-if="item.popularity" class="popularity">
                                    ğŸ”¥ çƒ­åº¦: {{ item.popularity }}å•
                                </div>
                                <div v-if="item.reason" class="reason">
                                    ğŸ’¡ {{ item.reason }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ™ºèƒ½æœç´¢æ¨¡å— -->
            <div v-if="currentView === 'search'" class="module">
                <h2>ğŸ” æ™ºèƒ½æœç´¢</h2>
                <div class="card">
                    <div class="form-group">
                        <label>æœç´¢æŸ¥è¯¢:</label>
                        <input v-model="searchForm.query" 
                               type="text" 
                               placeholder="ä¾‹å¦‚: é™„è¿‘è¯„åˆ†é«˜çš„å·èœé¦†"
                               @keyup.enter="searchPois">
                    </div>
                    <div class="form-group">
                        <label>å•†åœˆ:</label>
                        <select v-model="searchForm.location">
                            <option value="">å…¨éƒ¨</option>
                            <option v-for="i in 11" :key="i" :value="i-1">å•†åœˆ {{ i-1 }}</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>æ’åºæ–¹å¼:</label>
                        <select v-model="searchForm.sort_by">
                            <option value="rating">æŒ‰è¯„åˆ†</option>
                            <option value="popularity">æŒ‰äººæ°”</option>
                        </select>
                    </div>
                    <button @click="searchPois" class="btn-primary" :disabled="loading">
                        {{ loading ? 'æœç´¢ä¸­...' : 'æœç´¢' }}
                    </button>
                </div>

                <!-- æœç´¢ç»“æœ -->
                <div v-if="searchResults.length > 0" class="results">
                    <h3>æœç´¢ç»“æœ ({{ searchResults.length }}ä¸ª)</h3>
                    <div v-if="searchIntent" class="intent-box">
                        <strong>è¯†åˆ«æ„å›¾:</strong> {{ searchIntent }}
                    </div>
                    <div class="result-list">
                        <div v-for="(poi, index) in searchResults" :key="index" class="result-item">
                            <div class="item-header">
                                <h4>{{ poi.wm_poi_name }}</h4>
                                <span class="badge">å•†åœˆ {{ poi.aor_id }}</span>
                            </div>
                            <div class="item-stats">
                                <span>â­ {{ poi.poi_score }}</span>
                                <span>ğŸšš {{ poi.delivery_comment_avg_score }}</span>
                                <span>ğŸœ {{ poi.food_comment_avg_score }}</span>
                                <span>ğŸ“¦ {{ poi.order_count }}å•</span>
                            </div>
                            <button @click="viewPoiDetail(poi.wm_poi_id)" class="btn-small">æŸ¥çœ‹è¯¦æƒ…</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- è¿è¥åˆ†ææ¨¡å— -->
            <div v-if="currentView === 'operation'" class="module">
                <h2>ğŸ“Š å•†å®¶è¿è¥åˆ†æ</h2>
                <div class="card">
                    <div class="form-group">
                        <label>å•†å®¶ID:</label>
                        <input v-model.number="operationForm.poi_id" type="number" placeholder="è¯·è¾“å…¥å•†å®¶ID">
                    </div>
                    <button @click="getOperationAnalysis" class="btn-primary" :disabled="loading">
                        {{ loading ? 'åˆ†æä¸­...' : 'è·å–è¿è¥åˆ†æ' }}
                    </button>
                </div>

                <!-- å•†å®¶è¯¦æƒ… -->
                <div v-if="poiDetail" class="card">
                    <h3>å•†å®¶ä¿¡æ¯</h3>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <label>å•†å®¶åç§°:</label>
                            <span>{{ poiDetail.wm_poi_name }}</span>
                        </div>
                        <div class="detail-item">
                            <label>ç»¼åˆè¯„åˆ†:</label>
                            <span>â­ {{ poiDetail.poi_score }}</span>
                        </div>
                        <div class="detail-item">
                            <label>æ€»è®¢å•æ•°:</label>
                            <span>{{ poiDetail.total_orders }}</span>
                        </div>
                        <div class="detail-item">
                            <label>å®¢æˆ·æ•°:</label>
                            <span>{{ poiDetail.unique_customers }}</span>
                        </div>
                    </div>
                </div>

                <!-- AIè¿è¥å»ºè®® -->
                <div v-if="operationAdvice" class="card advice-card">
                    <h3>ğŸ¤– AIè¿è¥å»ºè®®</h3>
                    <div class="advice-content">
                        {{ operationAdvice }}
                    </div>
                </div>

                <!-- æ™ºèƒ½é—®ç­” -->
                <div v-if="poiDetail" class="card">
                    <h3>ğŸ’¬ æ™ºèƒ½é—®ç­”</h3>
                    <div class="form-group">
                        <input v-model="qaQuestion" 
                               type="text" 
                               placeholder="ä¾‹å¦‚: å¦‚ä½•æå‡åˆé¤è®¢å•é‡ï¼Ÿ"
                               @keyup.enter="askQuestion">
                        <button @click="askQuestion" class="btn-primary" :disabled="loading">æé—®</button>
                    </div>
                    <div v-if="qaAnswer" class="answer-box">
                        <strong>å›ç­”:</strong>
                        <p>{{ qaAnswer }}</p>
                    </div>
                </div>
            </div>

            <!-- å¹³å°ç»Ÿè®¡æ¨¡å— -->
            <div v-if="currentView === 'stats'" class="module">
                <h2>ğŸ“ˆ å¹³å°ç»Ÿè®¡</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ‘¥</div>
                        <div class="stat-number">{{ stats.users?.toLocaleString() || 0 }}</div>
                        <div class="stat-label">æ³¨å†Œç”¨æˆ·</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ğŸª</div>
                        <div class="stat-number">{{ stats.pois?.toLocaleString() || 0 }}</div>
                        <div class="stat-label">åˆä½œå•†å®¶</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ğŸœ</div>
                        <div class="stat-number">{{ stats.spus?.toLocaleString() || 0 }}</div>
                        <div class="stat-label">èœå“æ•°é‡</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ“¦</div>
                        <div class="stat-number">{{ stats.orders?.toLocaleString() || 0 }}</div>
                        <div class="stat-label">æ€»è®¢å•æ•°</div>
                    </div>
                </div>
                <button @click="loadStats" class="btn-primary">åˆ·æ–°ç»Ÿè®¡</button>
            </div>
        </main>

        <!-- åº•éƒ¨ -->
        <footer class="footer">
            <p>ç¾å›¢å¤–å–æ¨èä¸è¿è¥åˆ†æå¹³å° v1.0 | åŸºäºå¤§æ¨¡å‹çš„æ™ºèƒ½æ¨èç³»ç»Ÿ</p>
        </footer>
    </div>

    <script src="static/js/app.js"></script>
</body>
</html>
